/*! dateCascade - v1.0 - 2014-03-27 10:10:59 AM
* Copyright (c) 2014 函谷; Licensed  */
KISSY.add("gallery/dateCascade/1.0/index",function(a,b,c,d){"use strict";function e(a){e.superclass.constructor.call(this,a),this.init()}var f=function(b){return"date"===a.type(b)&&"Invalid Date"!==b.toString()&&!isNaN(b)},g=function(a){return 10>a?"0"+a:a};return a.extend(e,b,{dayInMonth:[31,28,31,30,31,30,31,31,30,31,30,31],init:function(){var b,c,d=this.get("nodeYear"),e=this.get("nodeMonth"),f=this.get("nodeDay"),g=this.get("dateStart"),h=this.get("dateEnd"),i=this.get("dateDefault");if(d&&e&&f){if(this.ds={y:g.getFullYear(),m:g.getMonth()+1,d:g.getDate()},this.de={y:h.getFullYear(),m:h.getMonth()+1,d:h.getDate()},g>h||g>i||i>h)return a.log("error date!"),void 0;this.df={y:i.getFullYear(),m:i.getMonth()+1,d:i.getDate()},b=this.renderYear(),c=this.renderMonth(b),this.renderDay(b,c),this.bindEvent()}},bindEvent:function(){var a=this;d.on(this.get("nodeYear"),"change",function(b){var c,d,e;c=a.get("date"),d=b.target.value,e=a.renderMonth(d),a.renderDay(d,e),a.set("year",d),a.fire("change",{oldDate:c,newDate:a.get("date")})}),d.on(this.get("nodeMonth"),"change",function(b){var c,d,e;c=a.get("date"),d=a.get("year"),e=b.target.value,a.renderDay(d,e),a.set("month",e),a.fire("change",{oldDate:c,newDate:a.get("date")})}),d.on(this.get("nodeDay"),"change",function(b){var c,d;c=a.get("date"),d=b.target.value,a.set("day",d),a.fire("change",{oldDate:c,newDate:a.get("date")})})},renderYear:function(){var a,b,c,d=this.get("nodeYear"),e=this.df.y;if(d)for(a=this.getYearRange(),b=a.max;b>=a.min;b--)c=new Option(b,b),b==e&&(c.selected=!0),d.add(c,void 0);return this.set("year",e),e},renderMonth:function(a){var b,c,d,e,f,h=this.get("nodeMonth"),i=this.get("month")||this.df.m,j=!1;if(h){if(b=this.getMonthRange(a),e=h.options,f=e.length,f>0&&e[0].value==b.min&&e[f-1].value==b.max)return e[h.selectedIndex].value;for(h.innerHTML="",c=b.min;c<=b.max;c++)d=new Option(g(c),c),c==i&&(d.selected=!0,i=c,j=!0),h.add(d,void 0);j||(i=b.min)}return this.set("month",i),i},renderDay:function(a,b){var c,d,e,f,h,i=this.get("nodeDay"),j=this.get("day")||this.df.d,k=!1;if(i){if(c=this.getDayRange(a,b),f=i.options,h=f.length,h>0&&f[0].value==c.min&&f[h-1].value==c.max)return f[i.selectedIndex].value;for(i.innerHTML="",d=c.min;d<=c.max;d++)e=new Option(g(d),d),d==j&&(e.selected=!0,j=d,k=!0),i.add(e,void 0);k||(j=c.min)}return this.set("day",j),j},getYearRange:function(){return{min:this.ds.y,max:this.de.y}},getMonthRange:function(a){var b=this.ds,c=this.de,d=1,e=12;return a==b.y&&(d=b.m),a==c.y&&(e=c.m),{min:d,max:e}},getDayRange:function(a,b){var c=this.ds,d=this.de,e=1,f=0;return b&&(f=2==b?this.isLeapYear(a)?29:28:this.dayInMonth[b-1],a==c.y&&b==c.m&&(e=c.d),a==d.y&&b==d.m&&(f=d.d)),{min:e,max:f}},isLeapYear:function(a){return 0===a%4&&0!==a%100||0===a%400},getDate:function(){return this.get("date")},getYear:function(){return this.get("year")},getMonth:function(){return this.get("month")},getDay:function(){return this.get("day")}},{ATTRS:{nodeYear:{value:null,setter:function(a){var b,d=null;return(a=c.get(a))&&(b=a.tagName.toUpperCase(),"SELECT"===b&&(d=a)),d}},nodeMonth:{value:null,setter:function(a){var b,d=null;return(a=c.get(a))&&(b=a.tagName.toUpperCase(),"SELECT"===b&&(d=a)),d}},nodeDay:{value:null,setter:function(a){var b,d=null;return(a=c.get(a))&&(b=a.tagName.toUpperCase(),"SELECT"===b&&(d=a)),d}},dateStart:{value:new Date("1900/01/01"),setter:function(a){var b=new Date("1900/01/01");return a&&(f(a)?b=a:f(new Date(a))&&(b=new Date(a))),b}},dateEnd:{value:new Date,setter:function(a){var b=new Date;return a&&(f(a)?b=a:f(new Date(a))&&(b=new Date(a))),b}},dateDefault:{value:new Date,setter:function(a){var b=new Date;return b=new Date(b.getFullYear(),b.getMonth(),b.getDate(),0,0,0),a&&(f(a)?b=a:f(new Date(a))&&(b=new Date(a))),b}},date:{getter:function(){return this.get("year")+"-"+g(this.get("month"))+"-"+g(this.get("day"))}},year:{},month:{},day:{}}}),e},{requires:["base","dom","event"]});